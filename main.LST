C51 COMPILER V9.60.0.0   MAIN                                                              06/12/2022 21:53:21 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: F:\keil\C51\BIN\C51.EXE main.c LARGE OMF2 OPTIMIZE(8,SPEED) BROWSE INCDIR(.\Ä£¿é.\User;.\Public;.\G
                    -UI;.\APP\tftlcd;.\APP\touch;.\Ä£¿é) DEBUG TABS(2)

line level    source

   1          #include "STDIO.H"
   2          #include "REG52.H"
   3          #include "bsp_key.h"
   4          #include "public.h"
   5          #include "bsp_time.h"
   6          #include "uart.h"
   7          #include "tftlcd.h"
   8          #include "touch.h"
   9          #include "gui.h"
  10          #include "Progress.h"
  11          #include "ui.h"
  12          //-----Ö÷Òªº¯Êı
  13          void key_proc(void);
  14          void tft_proc(void);
  15          //-----¶¨Ê±Æ÷±äÁ¿
  16          long time_tick=0; 
  17          unsigned int key_delay=0;//°´¼üº¯Êı¼õËÙ±äÁ¿
  18          unsigned int tft_delay=0;//Òº¾§ÆÁº¯Êı¼õËÙ±äÁ¿
  19          unsigned int count=0;//ÔËĞĞÊ±¼ä
  20          unsigned int count_old=999;//ÉÏÒ»´ÎµÄÔËĞĞÊ±¼äÓÃÓÚÔÚÊ±¼ä¸Ä±äÊ±¸Ä±äÒº¾§ÆÁ
  21          unsigned char key_val=0;//¶ÁÈ¡µ½µÄ°´¼üÖµ
  22          unsigned char key_old=0,key_down=0;//ÉÏÒ»´ÎµÄ±äÁ¿ °´¼üµÄÏÂ½µÑØ
  23          unsigned char key_time=0;//ÓÃÓÚÅĞ¶ÏÊÇ·ñÊÇ³¤°´
  24          unsigned char key_long=0;//³¤°´±êÖ¾Î» ³¤°´Ê±Îª1
  25          unsigned char key_flag=0;//³¤°´¿ªÊ¼µÄÊ±ºòÖÃ1
  26          //-----È«¾Ö±äÁ¿
  27          unsigned char interface=1;//½çÃæÑ¡Ôñ  1³õÊ¼»¯½çÃæ 2½ø¶È±í½çÃæ 3×Ô¶¨ÒåÊ±¼ä½çÃæ
  28          unsigned char BUF[20];//×Ö·û´®»º´æÇøÓò
  29          unsigned char line=0;//¹â±êÑ¡ÔñµÄĞĞºÅ
  30          unsigned char line_old;//¹â±êÑ¡ÔñÉÏÒ»´ÎµÄĞĞºÅ
  31          extern struct Washing_time M_Time[4];//ÉùÃ÷Íâ²¿¸÷¸öÄ£Ê½Ê±¼äµÄ½á¹¹Ìå
  32          extern code struct STU const Custom[];//ÉùÃ÷×Ô¶¨Òå½çÃæµÄ½á¹¹Ìå
  33          
  34          unsigned char Laundry_Mode=0; //Ï´ÒÂÄ£Ê½ 0Ç¿Á¦Ä£Ê½ 1±ê×¼Ä£Ê½ 2¿ìËÙÄ£Ê½
  35          unsigned char indicate=0;//0ÎŞ  1½øË® 2Ï´µÓ 3Æ¯Ï´ 4ÍÑË® 5½áÊø
  36          unsigned int Start_Time=0;//´æ·Å¹ı³ÌµÄÆğÊ¼Ê±¼ä
  37          unsigned char Temporary_time[4] = {0,0,0,0};//´¢´æ×Ô¶¨ÒåÄ£Ê½Ê±¼äµÄÖĞ¼ä±äÁ¿
  38          unsigned char Position[4]={125,117,101,149};//Òº¾§ÆÁÎÄ×ÖºóÊı×ÖËùÔÚµÄÎ»ÖÃ
  39          
  40          /*******************************************************************************
  41          * º¯ Êı Ãû       : main
  42          * º¯Êı¹¦ÄÜ     : Ö÷º¯Êı
  43          * Êä    Èë       : ÎŞ
  44          * Êä    ³ö       : ÎŞ
  45          *******************************************************************************/
  46          void main()
  47          { 
  48   1        UART_Init();//´®¿Ú³õÊ¼»¯
  49   1        TFTLCD_Init();//Òº¾§ÆÁ³õÊ¼»¯
  50   1        Mode_Selection();//³õÊ¼»¯½çÃæ Ñ¡ÔñĞèÒªÄÄ¸öÄ£Ê½
  51   1        //ProgressBar_Test();
  52   1        time0_init();//¶¨Ê±Æ÷³õÊ¼»¯
  53   1        printf("init OK\r\n");//´®¿ÚÖØ¶¨ÏòÊä³öµ÷ÊÔĞÅÏ¢
  54   1        while(1)
C51 COMPILER V9.60.0.0   MAIN                                                              06/12/2022 21:53:21 PAGE 2   

  55   1        {   
  56   2          key_proc();//°´¼üº¯Êı
  57   2          tft_proc();//Òº¾§ÆÁº¯Êı
  58   2        }   
  59   1      }
  60          
  61          
  62          
  63          /***********************¶¨Ê±Æ÷0ÖĞ¶Ïº¯Êı(10ms)***********************/
  64          void time0() interrupt 1 
  65          {
  66   1        time_tick ++;
  67   1        TH0=0XD8; //¸ø¶¨Ê±Æ÷¸³³õÖµ£¬¶¨Ê±10ms
  68   1        TL0=0XF0;
  69   1        if(key_delay)//Ö»ÓĞ²»µÈÓÚ0µÄÊ±ºò¿ÉÒÔ¼Ó
  70   1          key_delay = 0;//10msÉ¨ÃèÒ»´Î°´¼ü
  71   1        
  72   1        if(tft_delay)//Ö»ÓĞ²»µÈÓÚ0µÄÊ±ºò¿ÉÒÔ¼Ó
  73   1          if(++tft_delay == 40) tft_delay = 0;//400ms½øÒ»´ÎÒº¾§ÆÁº¯Êı
  74   1        
  75   1        if(!(time_tick % 100))
  76   1          count++;//ÔËĞĞÊ±¼ä
  77   1      }
  78          
  79          /***********************°´¼üº¯ÊıºÍÒº¾§ÆÁ´ó·¶Î§±ä»¯º¯Êı***********************/
  80          void key_proc(void)
  81          {
  82   1        if(key_delay) return;//Ê±¼äÃ»ÓĞµ½¾Í·µ»Ø
  83   1          else key_delay = 1;
  84   1        key_val = key_scan();//¶ÁÈ¡¶ÀÁ¢°´¼üº¯Êı
  85   1        key_down = key_val & (key_val ^ key_old);//¶ÁÈ¡ÏÂ½µÑØ Èç¹û²»ÊÇÏÂ½µÑØÔòÎª0
  86   1        
  87   1        if((key_val == 6)&&(key_old == 0))//6¸Õ°´ÏÂÊ±
  88   1        {
  89   2          key_flag = 1;//±íÊ¾µÚÒ»´Î°´ÏÂ
  90   2          key_down = 0;//ÏÈ²»½øswitch
  91   2        }
  92   1        
  93   1        if(key_flag)
  94   1          key_time++;//°´¼üº¯Êı´ó¸Å10ms½øÒ»´Î ËùÒÔ10ms¼ÓÒ»´Î  
  95   1        
  96   1        if((key_val == 0)&&(key_old == 6))//6·Å¿ªÊ±ÅĞ¶ÏÊÇ·ñÊÇ³¤°´
  97   1        { 
  98   2          if(key_time >= 100)
  99   2            key_long = 1;//³¤°´±êÖ¾Î»ÖÃ1
 100   2          else
 101   2            key_long = 0;//³¤°´±êÖ¾Î»ÖÃ0
 102   2          key_flag = 0;//±êÖ¾Î»Çå0
 103   2          key_time = 0;//Ê±¼äÇå0
 104   2          key_down = 6;//½øswitch
 105   2        }
 106   1        if(key_down != 0)
 107   1          printf("%d\r\n",(u16)key_down);//³öÏÖÏÂ½µÑØÊ±Êä³öµ÷ÊÔĞÅÏ¢
 108   1        
 109   1        switch(key_down)//¸÷¸ö°´¼üµÄ±ä»¯
 110   1        {
 111   2          
 112   2          case 1://ÔÚ½çÃæÒ»ºÍÈıÊ±ÎªÏòÉÏÒÆ¶¯¹â±ê
 113   2            if(--line == 255) line = 3;     
 114   2            if(interface == 1)//ÏòÉÏÑ¡Ôñ°´Å¥
 115   2              Choice(line,line_old,Initialization);//Ñ¡ÖĞÊ±±êºì ÊäÈë²ÎÊıÎª ĞĞºÅ ÉÏÒ»¸öµÄĞĞºÅ ºÍ½çÃæ±àºÅ
 116   2            else if(interface == 3)
C51 COMPILER V9.60.0.0   MAIN                                                              06/12/2022 21:53:21 PAGE 3   

 117   2              Choice(line,line_old,Customize);//Ñ¡ÖĞÊ±±êºì ÊäÈë²ÎÊıÎª ĞĞºÅ ÉÏÒ»¸öµÄĞĞºÅ ºÍ½çÃæ±àºÅ
 118   2            
 119   2          break;
 120   2              
 121   2          case 5://ÔÚ½çÃæÒ»ºÍÈıÊ±ÎªÏòÏÂÒÆ¶¯¹â±ê
 122   2            if(++line == 4) line = 0;
 123   2            if(interface == 1)//ÏòÉÏÑ¡Ôñ°´Å¥
 124   2              Choice(line,line_old,Initialization);//Ñ¡ÖĞÊ±±êºì ÊäÈë²ÎÊıÎª ĞĞºÅ ÉÏÒ»¸öµÄĞĞºÅ ºÍ½çÃæ±àºÅ
 125   2            else if(interface == 3)
 126   2              Choice(line,line_old,Customize);//Ñ¡ÖĞÊ±±êºì ÊäÈë²ÎÊıÎª ĞĞºÅ ÉÏÒ»¸öµÄĞĞºÅ ºÍ½çÃæ±àºÅ
 127   2          break;
 128   2          
 129   2          case 6: 
 130   2          if((interface == 3) && (key_long == 1))//Îª³¤°´Ê±ÎªÈ·¶¨
 131   2          {
 132   3            //ÔÚ×Ô¶¨Òå½çÃæÊ±Îª½«ÁÙÊ±µÄÊ±¼äÊı×é¸³Öµ¸ø½á¹¹Ìå
 133   3            M_Time[3].Wat=(u16)Temporary_time[0];//°´È·¶¨ÒÔºó¸³ÖµÊ±¼ä
 134   3            M_Time[3].Was=(u16)Temporary_time[1];
 135   3            M_Time[3].Ri=(u16)Temporary_time[2];
 136   3            M_Time[3].De=(u16)Temporary_time[3];
 137   3            printf("%d,%d,%d,%d\r\n",(u16)M_Time[3].Wat,(u16)M_Time[3].Was,(u16)M_Time[3].Ri,(u16)M_Time[3].De);//Ê
             -ä³öµ÷ÊÔĞÅÏ¢
 138   3            interface = 2;//½çÃæÇĞ»»µ½½ø¶ÈÌõ½çÃæ
 139   3            Schedule();//½ø¶È±í½çÃæ
 140   3            Laundry_Mode = 3;//Ä£Ê½Îª×Ô¶¨ÒåÄ£Ê½
 141   3            Start_Time = count;//¸³Öµ½øË®ÆğÊ¼Ê±¼ä
 142   3            indicate = 1;//½ø³ÌÎª½øË®
 143   3          }else if((interface == 3) && (key_long == 0))//Îª¶Ì°´Ê±ÎªÊ±¼ä¼õ
 144   2          {
 145   3              if(Temporary_time[line] >= 5)//´óÓÚ5²Å¿ÉÒÔ¼õ
 146   3                Temporary_time[line] -= 5;//¶ÔÓ¦Ê±¼ä-5
 147   3              sprintf(BUF,"%02d",(u16)Temporary_time[line]);//¸ñÊ½»¯×Ö·û´®
 148   3              LCD_ShowString(Position[line],Custom[line].y,tftlcd_data.width,tftlcd_data.height,16,BUF);//Òº¾§ÆÁÊä³ö
 149   3          }
 150   2          
 151   2          if(interface == 1)//ÔÚÄ£Ê½½çÃæÊ±ÎªÈ·¶¨°´Å¥
 152   2          {
 153   3              if(line != 3)//²»ÊÇ×Ô¶¨ÒåÄ£Ê½Ê±
 154   3              {
 155   4                interface = 2;//½ø¶ÈÌõ½çÃæ
 156   4                Schedule();//½ø¶È±í½çÃæ
 157   4                Laundry_Mode = line;//Ä£Ê½ÎªĞĞºÅ
 158   4                Start_Time = count;//¸³Öµ½øË®ÆğÊ¼Ê±¼ä
 159   4                indicate = 1;//½ø³ÌÎª½øË®
 160   4              }else
 161   3              {
 162   4                line = 0;//ĞĞÊıÇå0
 163   4                Custom_Time();//×Ô¶¨Òå½çÃæ
 164   4                interface = 3;//½çÃæ3 ×Ô¶¨ÒåÄ£Ê½
 165   4              }
 166   3           }
 167   2          if(indicate == 6)//µ«Ï´ÒÂ½áÊøÊ±°´ÏÂ°´¼ü6¿ÉÒÔÔÙÀ´Ò»´Î
 168   2          {
 169   3            indicate=0;
 170   3            interface=1;//³õÊ¼»¯½çÃæ
 171   3            line = 0;//ĞĞÊıÇå0
 172   3            LCD_Clear(BACK_COLOR);//ÇåÆÁÎªºÚÉ«
 173   3            Mode_Selection();//³õÊ¼»¯½çÃæ Ñ¡ÔñĞèÒªÄÄ¸öÄ£Ê½
 174   3          }
 175   2            
 176   2          break;
 177   2          
C51 COMPILER V9.60.0.0   MAIN                                                              06/12/2022 21:53:21 PAGE 4   

 178   2          case 2:
 179   2            if(interface == 3)//ÔÚ×Ô¶¨Òå½çÃæÊ±
 180   2            {
 181   3              if(Temporary_time[line] <= 95)//Ê±¼ä²»ÄÜ³¬¹ı100
 182   3                Temporary_time[line] += 5;//¶ÔÓ¦Ê±¼ä+5
 183   3              sprintf(BUF,"%d",(u16)Temporary_time[line]);//¸ñÊ½»¯×Ö·û´®
 184   3              LCD_ShowString(Position[line],Custom[line].y,tftlcd_data.width,tftlcd_data.height,16,BUF);//Òº¾§ÆÁÊä³ö
 185   3            }
 186   2          break;    
 187   2        }
 188   1        key_old = key_val;//ÎªÉÏÒ»´ÎµÄ°´¼üÖµ¸³Öµ
 189   1        line_old = line;//¶ÁÈ¡ÉÏÒ»´ÎµÄĞĞºÅ
 190   1      }
 191          
 192          /***********************Òº¾§ÆÁĞ¡·¶Î§±ä»¯º¯Êı***********************/
 193          void tft_proc(void)
 194          {
 195   1        if(tft_delay) return;//Ã»µ½Ê±¼ä·µ»ØÖ÷º¯Êı
 196   1          else tft_delay = 1;
 197   1        if(count != count_old)//µ±Ê±¼ä¸Ä±äÊ±
 198   1        {
 199   2          sprintf(BUF,"%u",(u16)count);//¸ñÊ½Ê±¼äÎª×Ö·û´®
 200   2          FRONT_COLOR=WHITE;
 201   2          LCD_ShowString(109,300,tftlcd_data.width,tftlcd_data.height,16,BUF);//½«Ê±¼äÏÔÊ¾ÔÚÆÁÄ»ÉÏ
 202   2          switch (indicate)//0ÎŞ  1½øË® 2Ï´µÓ 3Æ¯Ï´ 4ÍÑË®
 203   2          {
 204   3              case 1://½øË®½ø¶ÈÌõ
 205   3                Progress_Bar(Start_Time,M_Time[Laundry_Mode].Wat,count,10,70);//½ø¶ÈÌõº¯Êı
 206   3              break;
 207   3              
 208   3              case 2://Ï´µÓ½ø¶ÈÌõ
 209   3                Progress_Bar(Start_Time,M_Time[Laundry_Mode].Was,count,10,110);
 210   3              break;
 211   3              
 212   3              case 3://Æ¯Ï´½ø¶ÈÌõ
 213   3                Progress_Bar(Start_Time,M_Time[Laundry_Mode].Ri,count,10,150);
 214   3              break;
 215   3              
 216   3              case 4://ÍÑË®½ø¶ÈÌõ
 217   3                Progress_Bar(Start_Time,M_Time[Laundry_Mode].De,count,10,190);
 218   3              break;
 219   3              
 220   3              case 5://½áÊø
 221   3                LCD_ShowString(Plan[4].x,Plan[4].y,tftlcd_data.width,tftlcd_data.height,16,Plan[4].str);//Òº¾§ÆÁÊä³ö
 222   3                indicate++;//·ÀÖ¹Ò»Ö±Êä³ö
 223   3              break;  
 224   3            }
 225   2        
 226   2          count_old = count;//ÎªÉÏÒ»´ÎµÄÊ±¼ä¸³Öµ
 227   2        }
 228   1      }
 229          
 230          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1583    ----
   CONSTANT SIZE    =     40    ----
   XDATA SIZE       =     53    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
C51 COMPILER V9.60.0.0   MAIN                                                              06/12/2022 21:53:21 PAGE 5   

   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
